<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <title>Cinema schedule</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
            crossorigin="anonymous"></script>
    <link rel="stylesheet" type="text/css" th:href="@{/webjars/bootstrap/css/bootstrap.min.css}" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css"
          integrity="sha512-xh6O/CkQoPOWDdYTDqeRdPCVd1SpvCA9XXcUnZS2FmJNp1coAFzvtCN9BmamE+4aHK8yyUHUSCcJHgXloTyT2A=="
          crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script type="text/javascript" th:src="@{/webjars/jquery/jquery.min.js}"></script>
    <script type="text/javascript" th:src="@{/webjars/bootstrap/js/bootstrap.min.js}"></script>
</head>
<body>
<div class="container">
    <h4>Hello
        <td th:text="${session.username}"/>
    </h4>
    <button th:if="${session.isAdmin}" type="button" class="btn btn-primary"
            th:onclick="|window.location.href='index'|"> Back to schedule
    </button>
       <button th:unless="${session.isAdmin}" type="button" class="btn btn-primary"
            th:onclick="|window.location.href='user-schedule'|"> Back to schedule
    </button>
    <button type="button" class="btn btn-primary" th:if="${session.isAdmin}"
            th:onclick="|window.location.href='repertoire/add'|">Add movie
    </button>
    <button type="button" class="btn btn-primary" th:if="${session.isAdmin}"
            th:onclick="|window.location.href='tickets-sold'|">Tickets sold
    </button>

</div>
<div class="container">
    <div
            th:if="${message != null and session.isAdmin}"
            class="alert alert-secondary alert-dismissible fade show text-center message mt-3"
            role="alert">
        [[${message}]]
    </div>
    <div>
        <h2 style="position: relative; left: 45%">Repertoire</h2>
        <table class="table table-striped">
            <tr>
                <th></th>
                <th>Title</th>
                <th>Released</th>
                <th>Duration (m)</th>
                <th>Directed</th>
                <th th:if="${session.isAdmin}">Add/update poster</th>
                <th></th>
                <th></th>
                <th></th>
            </tr>
            <tr th:each="movie : ${repertoire}">
                <td><img th:src="${movie.image}" th:alt="${movie.title}"
                         style="width: 100px;"/></td>
                <td th:text="${movie.title}"></td>
                <td th:text="${movie.released}"></td>
                <td th:text="${movie.durationM}"></td>
                <td th:text="${movie.directed}"></td>
                <td>
                    <form th:if="${session.isAdmin}"
                            id="uploadForm"
                            method="post"
                            th:action="@{/images/upload/{id}(id=${movie.id})}"
                            enctype="multipart/form-data">
                        <input id="input-file" type="file" name="file" accept="image/png, image/jpeg, image/jpg" />
                        <button class="btn btn-sm btn-outline-success float-right" type="submit">
                            Upload
                        </button>
                    </form>
                </td>
                <td th:if="${session.isAdmin}">
                    <div>
                        <a th:href="@{'/images/delete/' + ${movie.image}}" th:fileName="${movie.image}" id="btnDelete"
                           title="Delete this image" class="fa-regular fa-trash-can icon-dark btn-delete"></a>
                    </div>
                </td>
                <td>
                    <form th:if="${session.isAdmin}" th:method="post"
                          th:action="@{performance/add/{id}(id=${movie.id})}">
                        <button type="submit" class="btn btn-primary">Create show</button>
                    </form>
                </td>
                <td>
                    <form th:if="${session.isAdmin}" th:method="post"
                          th:action="@{repertoire/delete/{id}(id=${movie.id})}">
                        <button type="submit" class="btn btn-danger">Delete movie</button>
                    </form>
                </td>

            </tr>
        </table>
    </div>
</div>
</body>
</html>